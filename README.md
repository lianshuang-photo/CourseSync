# 课表转ICS工具

这个工具可以将文本格式的课表信息转换为ICS格式的日历文件，方便导入到Apple日历、Google日历等应用中。无需手动输入每一节课程，只需复制粘贴课表文本，一键生成完整学期的课程表。

## 功能特点

- 简单高效，只提取必要的课程信息
- 自动识别课程名称、教师、地点等关键要素
- 支持单周和范围周次（如1周、1~8周）
- 正确解析节次与具体时间的对应关系
- 自动处理重复周次，避免同一周的课程重复出现
- 生成标准ICS格式文件，可直接导入各类日历软件
- 同时生成JSON格式的结构化数据，便于查看和验证

## 安装步骤

1. 确保已安装Python 3.6或以上版本
2. 克隆或下载本仓库到本地
3. 安装依赖库

```bash
# 安装依赖
pip install -r requirements.txt
```

## 使用方法

### 基本使用流程

1. 准备课表文本文件
   - 将课表内容保存为`kebiao.txt`文件，放在程序同一目录下
   - 课表格式见下方说明

2. 运行程序

```bash
python main.py
```

3. 输入学期开始日期
   - 按提示输入学期开始日期（格式：YYYY-MM-DD）
   - 例如，如果学期从2024年3月4日开始，请输入：`2024-03-04`

4. 获取结果文件
   - 程序将生成`schedule.ics`文件，可直接导入到日历软件
   - 同时生成`course_data.json`文件，包含结构化的课程数据

### 课表格式要求及示例

程序可以识别如下格式的课程信息：

```
课程名称
学分信息（可选）
1~8周 星期四 第九节~十二节节 金海12610 张三

Python Django框架开发实践
1~12周 星期一 第七节~第八节节 金海12614 王五
```

关键要素说明：
- **课程名称**：必须位于课程信息块的第一行
- **周次信息**：支持"1~8周"（范围）和"10周"（单周）格式
- **星期信息**：如"星期一"、"星期四"等
- **节次信息**：如"第一节~第二节"、"第九节~十二节节"（注意末尾可能有多余的"节"字）
- **上课地点**：如"金海12610"（程序会自动处理地点中的空格）
- **授课教师**：如"张三"，位于行尾

### 支持的特殊格式

程序可以处理多种特殊情况：
- 多个上课时间：如"9~14周 星期二 第五节~第六节节 金海 12510 李四; 9~14周 星期二 第七节~第八节节 金海 12510 李四"
- 重复周次：如"5-16周, 16-16周"，程序会自动去重
- 无排课数据的课程：如标注"无排课数据"的课程会被自动跳过

## 课程时间设置

### 单节次时间表

| 节次 | 开始时间 | 结束时间 |
|------|---------|---------|
| 第一节 | 08:00 | 08:45 |
| 第二节 | 08:55 | 09:30 |
| 第三节 | 09:40 | 10:25 |
| 第四节 | 10:35 | 11:10 |
| 第五节 | 12:40 | 13:25 |
| 第六节 | 13:35 | 14:10 |
| 第七节 | 14:20 | 15:05 |
| 第八节 | 15:15 | 15:50 |
| 第九节 | 17:00 | 17:45 |
| 第十节 | 17:55 | 18:40 |
| 第十一节 | 18:50 | 19:35 |
| 第十二节 | 19:45 | 20:10 |

### 合并节次时间表

程序会优先使用以下合并节次的时间设置：

| 节次组合 | 开始时间 | 结束时间 |
|---------|---------|---------|
| 第一节-第二节 | 08:00 | 09:30 |
| 第三节-第四节 | 09:40 | 11:10 |
| 第五节-第六节 | 12:40 | 14:10 |
| 第七节-第八节 | 14:20 | 15:50 |
| 第九节-第十二节 | 17:00 | 20:10 |

如需修改时间设置，请编辑`main.py`中的`class_time_map`和`merged_time_map`字典。

## 日历导入指南

### Apple日历

1. 打开Apple日历应用
2. 点击"文件" > "导入"
3. 选择生成的`schedule.ics`文件
4. 选择要将课程添加到哪个日历中
5. 点击"导入"完成操作

### Google日历

1. 打开Google日历网页版
2. 点击右上角的设置图标，选择"设置"
3. 在左侧菜单中选择"导入与导出"
4. 点击"选择文件"，上传生成的`schedule.ics`文件
5. 选择要将课程添加到哪个日历中，然后点击"导入"

### 手机日历应用

1. 将生成的`schedule.ics`文件发送到手机（通过邮件、微信或其他方式）
2. 在手机上点击该文件
3. 选择用日历应用打开
4. 按照提示完成导入操作

## 常见问题解答（FAQ）

### Q1: 为什么某些课程没有被解析？
A: 可能原因包括：
- 课程没有具体的时间地点信息（如标记为"无排课数据"）
- 课程信息格式与程序期望的格式不匹配

### Q2: 如何修改课程的时间设置？
A: 编辑`main.py`文件中的`class_time_map`和`merged_time_map`字典来调整时间设置。例如，如果您的学校第一节课是8:30开始，可以修改相应的时间值。

### Q3: 生成的ICS文件如何显示中文？
A: 程序默认支持中文，但某些日历应用可能需要正确的字符编码。如果遇到中文显示问题，可以尝试在导入前将文件保存为UTF-8编码。

### Q4: 学期中途课表变更怎么处理？
A: 有两种方法：
- 删除原有日历中的课程，然后重新导入新的ICS文件
- 仅更新变更的课程，手动添加或删除

### Q5: 程序报错"日期格式错误"怎么办？
A: 确保输入的学期开始日期格式为"YYYY-MM-DD"，例如"2024-09-01"。

## 进阶定制

### 自定义周次计算规则

如果您的学校有特殊的周次计算规则（如跳过节假日），可以修改`generate_events`函数中的日期计算逻辑。

### 添加更多事件详情

如需在日历事件中添加更多信息（如课程代码、学分等），可以修改`generate_events`函数中的`description`部分。

### 批量处理多个课表

如需批量处理多个课表，可以编写脚本循环调用`main.py`，或修改代码接受命令行参数。

## 贡献与反馈

欢迎提交问题报告和功能建议，帮助我们改进这个工具。如果您有任何疑问或需要帮助，请创建Issue或联系开发者。 
